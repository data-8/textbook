<div id="ipython-notebook">
            <a class="interact-button" href="http://data8.berkeley.edu/hub/interact?repo=textbook&path=notebooks/trip.csv&path=notebooks/Confidence.ipynb">Interact</a>
            
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\(','\)']],
      processEscapes: true
    }
  });
</script>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Whenever we analyze a random sample of a population, our goal is to draw robust conclusions about the whole population, despite the fact that we can measure only part of it. We must guard against being misled by the inevitable random variations in a sample. It is possible that a sample has very different characteristics than the population itself, but those samples are unlikely. It is much more typical that a random sample, especially a large simple random sample, is representative of the population. More importantly, the chance that a sample resembles the population is something that we know in advance, based on how we selected our random sample. Statistical inference is the practice of using this information to make precise statements about a population based on a random sample.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Statistics-and-Parameters">Statistics and Parameters<a class="anchor-link" href="#Statistics-and-Parameters">¶</a></h2><p>The <a href="http://www.bayareabikeshare.com/">Bay Area Bike Share</a> service published a <a href="http://www.bayareabikeshare.com/open-data">dataset</a> describing every bicycle rental from September 2014 to August 2015 in their system. This set of all trips is a population, and fortunately we have the data for each and every trip rather than just a sample. We'll focus only on the <em>free trips</em>, which are trips that last less than 1800 seconds (half an hour).</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">free_trips</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s">"trip.csv"</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">,</span> <span class="n">are</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="mi">1800</span><span class="p">))</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">free_trips</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Start Station</th> <th>End Station</th> <th>Duration</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Harry Bridges Plaza (Ferry Building)         </td> <td>San Francisco Caltrain (Townsend at 4th)     </td> <td>765     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>San Antonio Shopping Center                  </td> <td>Mountain View City Hall                      </td> <td>1036    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Post at Kearny                               </td> <td>2nd at South Park                            </td> <td>307     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>San Jose City Hall                           </td> <td>San Salvador at 1st                          </td> <td>409     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Embarcadero at Folsom                        </td> <td>Embarcadero at Sansome                       </td> <td>789     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Yerba Buena Center of the Arts (3rd @ Howard)</td> <td>San Francisco Caltrain (Townsend at 4th)     </td> <td>293     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Embarcadero at Folsom                        </td> <td>Embarcadero at Sansome                       </td> <td>896     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Embarcadero at Sansome                       </td> <td>Steuart at Market                            </td> <td>255     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Beale at Market                              </td> <td>Temporary Transbay Terminal (Howard at Beale)</td> <td>126     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Post at Kearny                               </td> <td>South Van Ness at Market                     </td> <td>932     </td>
        </tr>
    </tbody>
</table>
<p>... (338333 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A quantity measured for a whole population is called a <em>parameter</em>. For example, the average duration for any free trip between September 2014 to August 2015 can be computed exactly from these data: 550.00.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">free_trips</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>550.00143345658103</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Although we have information for the full population, we will investigate what we can learn from a simple random sample. Below, we sample 100 trips without replacement from <code>free_trips</code> not just once, but 40 different times. All 4000 trips are stored in a table called <code>samples</code>.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="s">'Duration'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">trip</span> <span class="ow">in</span> <span class="n">free_trips</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">trip</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">)])</span>
<span class="n">samples</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Sample #</th> <th>Duration</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>0       </td> <td>269     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>662     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>247     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>594     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>756     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>1085    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>559     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>143     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>191     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td> <td>227     </td>
        </tr>
    </tbody>
</table>
<p>... (3990 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A quantity measured for a sample is called a <em>statistic</em>. For example, the average duration of a free trip in a sample is a statistic, and we find that there is some variation across samples.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">sample_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">"Average duration in sample"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s">"is"</span><span class="p">,</span> <span class="n">sample_average</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Average duration in sample 0 is 577.79
Average duration in sample 1 is 602.45
Average duration in sample 2 is 575.95
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Often, the goal of analysis is to estimate parameters from statistics. Proper statistical inference involves more than just picking an estimate: we should also say something about how confident we should be in that estimate. A single guess is rarely sufficient to make a robust conclusion about a population. We also need to quantify in some way how precise we believe that guess to be.</p>
<p>Already we can see from the example above that the average duration of a sample is around 550, the parameter. Our goal is to quantify this notion of <em>around</em>, and one way to do so is to state a range of values.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Error-in-Estimates">Error in Estimates<a class="anchor-link" href="#Error-in-Estimates">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can learn a great deal about the behavior of a statistic by computing it for many samples. In the scatter diagram below, the order in which the statistic was computed appears on the horizontal axis, and the value of the average duration for a sample of <code>n</code> trips appears on the vertical axis.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">samples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_13_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The sample number doesn't tell us anything beyond when the sample was selected, and we can see from this unstructured cloud of points that one sample does not affect the next in any consistent way. The sample averages are indeed all around 550. Some are above, and some are below.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">samples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">641</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_15_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 40 averages for 40 samples. If we find an interval that contains 38 out of 40, it will contain 95% of the samples. One such interval is bounded by the second smallest and the second largest sample averages among the 40 samples.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">averages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">averages</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">averages</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">38</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">'Empirically, 95% of sample averages fell within the interval'</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Empirically, 95% of sample averages fell within the interval 518.9 to 602.45
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Given that we know the true parameter is 550, we can make a related statement about this particular collection of 40 samples.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">max_deviation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">550</span><span class="o">-</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">-</span><span class="mi">550</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s">'Empirically, for 95% of samples, the sample average was within'</span><span class="p">,</span> 
      <span class="n">max_deviation</span><span class="p">,</span> <span class="s">'of the true average'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Empirically, for 95% of samples, the sample average was within 53.0 of the true average
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This statement gives us our first notion of a margin of error. If this statement were to hold up not just for our 40 samples, but for all samples, then a reasonable strategy for estimating the true population average would be to draw a 100-trip sample, compute its sample average, and guess that the true average was within <code>max_deviation</code> of this quantity. We would be right at least 95% of the time.</p>
<p>The problem with this approach is that finding the <code>max_deviation</code> required drawing many different samples, and we would like to be able to say something similar after having collected only one 100-trip sample.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Variability-Within-Samples">Variability Within Samples<a class="anchor-link" href="#Variability-Within-Samples">¶</a></h3><p>By contrast, The individual durations in the samples themselves are not closely clustered around 550. Instead, they span the whole range from 0 to 1800. The durations for the first three 100-item samples are visualized below. All have somewhat similar shapes; they were drawn from the same population.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">samples</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1801</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_22_0.png"/></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_22_1.png"/></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_22_2.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have now observed two different ways in which the variation of a random sample can be observed: the statistics computed from those samples vary in magnitude, and the sampled quantities themselves vary in distribution. That is, there is variability <em>across samples</em>, which we see by comparing sample averages, and there is variability <em>within each sample</em>, which we see in the duration histograms above.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Confidence-Intervals">Confidence Intervals<a class="anchor-link" href="#Confidence-Intervals">¶</a></h2><p>Inference begins with a population: a collection that you can describe but often cannot measure directly. One thing we can often do with a populuation is to draw a simple random sample. By measuring a statistic of the sample, we may hope to estimate a parameter of the population. In this process, the population is not random, nor are its parameters. The sample is random, and so is its statistic. The whole process of estimation therefore gives a random result. It starts from a population (fixed), draws a sample (random), computes a statistic (random), and then estimates the parameter from the statistic (random). By calling the process random, we mean that the final estimate could have been different because the sample could have been different.</p>
<p>A confidence interval is one notion of a margin of error around an estimate. The margin of error acknowledges that the estimation process could have been misleading because of the variation in the sample. It gives a range that might contain the original parameter, along with a percentage of confidence. For example, a 95% confidence interval is one in which we would expect the interval to contain the true parameter for 95% of random samples. For any particular sample, any particular estimate, and any particular interval, the parameter is either contained or not; we never know for sure. The purpose of the confidence interval is to quantify how often our estimation process gives us a range containing the truth.</p>
<p>There are many different ways to compute a confidence interval. The challenge in computing a confidence interval from a single sample is that we don't know the population, and so we don't know how its samples will vary. One way to make progress despite this limited information is to assume that the variability <em>within the sample</em> is similar to the variability within the population.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Resampling-from-a-Sample">Resampling from a Sample<a class="anchor-link" href="#Resampling-from-a-Sample">¶</a></h3><p>Even though we happen to have the whole population of <code>free_trips</code>, let's imagine for a moment that we have only a single 100-trip sample from this population. That sample has 100 durations. Our goal now is to learn what we can about the population using just this sample.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sample</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">"Sample #"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">sample_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">))</span>
<span class="n">sample_average</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>577.78999999999996</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A technique called <em>bootstrap resampling</em> uses the variability of the sample as a proxy for the variability of the population. Instead of drawing many samples from the population, we will draw many samples from the sample. Since the original sample and the re-sampled sample have the same size, we must draw with replacement in order to see any variability at all.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">resamples</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="s">'Resample #'</span><span class="p">,</span> <span class="s">'Duration'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">trip</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">with_replacement</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">resamples</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">trip</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">)])</span>
<span class="n">resamples</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Resample #</th> <th>Duration</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>0         </td> <td>1085    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>391     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>199     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>1216    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>1050    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>501     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>227     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>376     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>560     </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0         </td> <td>532     </td>
        </tr>
    </tbody>
</table>
<p>... (3990 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the <code>resamples</code>, we can investigate the variability of the corresponding sample averages.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">resamples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_30_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These sample averages are not necessarily clustered around the true average 550. Instead, they will be clustered around the average of the sample from which they were re-sampled.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">resamples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">641</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_32_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Although the center of this distribution is not the same as the true population average, the spread is similar. We use as our confidence interval around the sample average the max deviation among the 95% (38 out of 40) that exclude the most extreme values.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">averages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">resamples</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">averages</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">averages</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">38</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">'A 95% confidence interval:'</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>A 95% confidence interval: 529.91 to 611.87
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is also reasonable to center the interval around the sample average by computing the max deviation within this interval.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">max_deviation</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sample_average</span><span class="o">-</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">-</span><span class="n">sample_average</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">'Another 95% confidence interval:'</span><span class="p">,</span> <span class="n">sample_average</span><span class="p">,</span> <span class="s">'+/-'</span><span class="p">,</span> <span class="n">max_deviation</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Another 95% confidence interval: 577.79 +/- 47.88
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Evaluating-Confidence-Intervals">Evaluating Confidence Intervals<a class="anchor-link" href="#Evaluating-Confidence-Intervals">¶</a></h3><p>When given only a sample, it is not possible to check whether the parameter was estimated correctly. However, in the case of the Bay Area Bike Share, we have not only the sample, but many samples and the whole population. Therefore, we can check how often the confidence intervals we compute in this way do in fact contain the true parameter.</p>
<p>Before measuring the accuracy of our technique, we can visualize the result of resampling each sample. The following scatter diagram has 40 vertical lines for 40 samples, and each line consists of 40 points for 40 resampled means.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">resample_averages</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="s">'Resample average'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
        <span class="n">resample</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">with_replacement</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="n">resample_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">resample</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Duration'</span><span class="p">))</span>
        <span class="n">resample_averages</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">resample_average</span><span class="p">])</span>
<span class="n">resample_averages</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_38_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see from the plot above that for almost every sample, there are some resampled averages above 550 and some below. When we use these resampled averages to compute confidence intervals, many of those intervals contain 550 as a result. Below, the <code>Lower</code> bounds of the confidence intervals for almost all of the samples are below the true average 550. Likewise, the <code>Upper</code> bounds are almost always above 550. We have a process for computing confidence intervals that almost always finds an interval containing the truth.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">lowers</span> <span class="o">=</span> <span class="n">resample_averages</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">2.5</span><span class="p">))</span>
<span class="n">uppers</span> <span class="o">=</span> <span class="n">resample_averages</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">97.5</span><span class="p">))</span>
<span class="n">intervals</span> <span class="o">=</span> <span class="n">uppers</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">'Sample #'</span><span class="p">,</span> <span class="n">lowers</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'Upper'</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Lower'</span><span class="p">)</span>
<span class="n">intervals</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_40_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can compute precisely which intervals contain the truth, and we find that about 95% of them do. Since we resampled only a small number of times (10,000 resamples is much more typical than 40 for computing 95% confidence intervals) and began with fairly small samples of size 100, we may find that a few more than 2 out of the 40 confidence intervals failed to contain the truth.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">intervals</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Lower'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">550</span><span class="p">,</span> 
               <span class="n">intervals</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Upper'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">550</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>array([ True, False,  True,  True,  True,  True, False,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True, False,
        True,  True,  True,  True], dtype=bool)</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each confidence interval is generated from only a single sample of 100 trips. As a result, the width of the interval varies quite a bit as well. Compared to the interval width we computed originally (which required multiple samples), we see that some of these intervals are much more narrow and some are much wider.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Width'</span><span class="p">,</span> <span class="n">intervals</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Upper'</span><span class="p">)</span><span class="o">-</span><span class="n">intervals</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">'Lower'</span><span class="p">))</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Confidence_44_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Given a single sample, it is impossible to know whether you have correctly estimated the parameter or not. However, you can infer a precise notion of confidence by following a process based on random sampling.</p></div></div></div>