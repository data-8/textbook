<div id="ipython-notebook">
            <a class="interact-button" href="https://mybinder.org/v2/gh/data-8/textbook/gh-pages?filepath=notebooks/Draft_Bootstrap.ipynb">Interact</a>
            
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$']],
      processEscapes: true
    }
  });
</script>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">datascience</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'Agg'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plots</span>
<span class="n">plots</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'fivethirtyeight'</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">united</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">'united_summer2015.csv'</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pop_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">united</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">'Delay'</span><span class="p">))</span>
<span class="n">pop_mean</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>16.658155515370705</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inference-about-a-parameter">Inference about a parameter<a class="anchor-link" href="#Inference-about-a-parameter">¶</a></h3><p>The average delay among all the flights is a parameter. We know it: it's roughly 16.66 minutes. But let's suppose we didn't know it, and let's see how to develop an estimate based on a random sample.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Specify the sample size.</span>

<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">400</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Take a random sample of that size from the population.</span>

<span class="n">sample1</span> <span class="o">=</span> <span class="n">united</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">with_replacement</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># These are all the data that we have. </span>
<span class="c1"># We can't get any more data directly from the population.</span>

<span class="n">sample1</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Date</th> <th>Flight Number</th> <th>Destination</th> <th>Delay</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>8/20/15</td> <td>1699         </td> <td>ATL        </td> <td>12   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>8/16/15</td> <td>887          </td> <td>LAX        </td> <td>2    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>8/19/15</td> <td>1796         </td> <td>IAD        </td> <td>2    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>7/27/15</td> <td>276          </td> <td>EWR        </td> <td>-5   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>7/6/15 </td> <td>1273         </td> <td>OGG        </td> <td>14   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>7/22/15</td> <td>1250         </td> <td>IAH        </td> <td>-4   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6/8/15 </td> <td>500          </td> <td>ORD        </td> <td>-6   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6/23/15</td> <td>1753         </td> <td>MCO        </td> <td>-1   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>8/13/15</td> <td>1531         </td> <td>RDU        </td> <td>-2   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>7/24/15</td> <td>691          </td> <td>SAN        </td> <td>-3   </td>
        </tr>
    </tbody>
</table>
<p>... (390 rows omitted)</p></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Histogram of the sampled delays</span>
<span class="n">every_ten</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">sample1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'Delay'</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">every_ten</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'minute'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_7_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Useful statistic: the mean of the sample</span>
<span class="c1"># This is a plausible estimate for the mean of the population,</span>
<span class="c1"># because we are betting that the large random sample resembles the population.</span>

<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample1</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">'Delay'</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>14.76</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="But-the-sample-could-have-been-different-...">But the sample could have been different ...<a class="anchor-link" href="#But-the-sample-could-have-been-different-...">¶</a></h3><p>So we have to give ourselves some wiggle room in the estimate.</p>
<p>Therefore, <strong>our estimate will be an interval</strong>, not just one number.</p>
<p>To get other plausible estimates, we need other samples. But we don't have other samples; we just have one.</p>
<p>So now what?</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Our-sample-looks-like-the-population-...">Our sample looks like the population ...<a class="anchor-link" href="#Our-sample-looks-like-the-population-...">¶</a></h3><p>Or at least that's a pretty good bet. Our sample is large and was drawn at random. So it should resemble the population.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-bootstrap:-a-brilliant-idea">The bootstrap: a brilliant idea<a class="anchor-link" href="#The-bootstrap:-a-brilliant-idea">¶</a></h3><p>Treat the <em>sample</em> as the population, and draw another sample from it!</p>
<p>Careful about sample size. We want another sample of the <em>same size</em> as the first one; we're trying to replicate the first sample.</p>
<p><strong>The Bootstrap Method</strong></p>
<ul>
<li>We'll use the sample as a proxy for the population, and draw a random sample <strong>from the sample</strong>.</li>
<li>The amount of sampling variability in an estimate depends on the sample size. So the new sample must have the same size as the original sample. </li>
<li>To get a random sample of size 200 from a "population" of size 200, we'll draw at random 200 times <strong>with replacement</strong>.</li>
</ul></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># You don't have to say what the sample size should be.</span>
<span class="c1"># The default is to sample as many times as the number of rows of the table.</span>
<span class="c1"># Perfect for the bootstrap!</span>

<span class="n">resample</span> <span class="o">=</span> <span class="n">sample1</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">resample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'Delay'</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">every_ten</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'minute'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_12_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-whole-lot-of-plausible-estimates">A whole lot of plausible estimates<a class="anchor-link" href="#A-whole-lot-of-plausible-estimates">¶</a></h3><p>Each of these new samples has a mean. Each of those means is a plausible estimate of the population mean.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_mean</span><span class="p">(</span><span class="n">original_sample</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">):</span>
    <span class="sd">"""Empirical distribution of sample mean:</span>
<span class="sd">    original_sample: table containing the original sample</span>
<span class="sd">    label: label of column containing the variable</span>
<span class="sd">    repetitions: number of repetitions of the bootstrap sampling process</span>
<span class="sd">    """</span>
    
    <span class="n">means</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
        <span class="n">bootstrap_sample</span> <span class="o">=</span> <span class="n">original_sample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="n">new_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">new_mean</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">means</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bstrap_means</span> <span class="o">=</span> <span class="n">bootstrap_mean</span><span class="p">(</span><span class="n">sample1</span><span class="p">,</span> <span class="s1">'Delay'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'Bootstrap Sample Mean'</span><span class="p">,</span> <span class="n">bstrap_means</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_15_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id='An-interval-estimate:-"confidence-interval-for-the-parameter"'>An interval estimate: "confidence interval for the parameter"<a class="anchor-link" href='#An-interval-estimate:-"confidence-interval-for-the-parameter"'>¶</a></h3><p>Proposed estimate for the parameter: <strong>the middle 95% of this distribution</strong></p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_CI_mean</span><span class="p">(</span><span class="n">original_sample</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">):</span>
    <span class="sd">"""Empirical distribution of sample mean:</span>
<span class="sd">    original_sample: table containing the original sample</span>
<span class="sd">    column_name: label of column containing the variable</span>
<span class="sd">    repetitions: number of repetitions of the bootstrap sampling process</span>
<span class="sd">    """</span>
    
    <span class="n">means</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
        <span class="n">bootstrap_sample</span> <span class="o">=</span> <span class="n">original_sample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="n">new_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">new_mean</span><span class="p">)</span>
        
    <span class="c1"># Get the endpoints of the confidence interval</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">97.5</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span>
    
    <span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'Bootstrap Sample Mean'</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="c1"># Mark the the confidence interval on the horizontal axis</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">make_array</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">),</span> <span class="n">make_array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gold'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="n">plots</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Approx 95% CI for Population Mean'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Left Endpoint:'</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Right Endpoint:'</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bootstrap_CI_mean</span><span class="p">(</span><span class="n">sample1</span><span class="p">,</span> <span class="s1">'Delay'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Left Endpoint: 10.93
Right Endpoint: 20.835
</pre></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_18_1.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-steps-of-the-process">The steps of the process<a class="anchor-link" href="#The-steps-of-the-process">¶</a></h3><ol>
<li>Take a random sample from the population.</li>
<li>Repeat the following over and over again:<ul>
<li>Bootstrap the sample</li>
<li>Compute the statistic</li>
</ul>
</li>
<li>Take the middle 95% of the distribution of the statistics that you calculated.</li>
</ol></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Is-this-process-any-good?">Is this process any good?<a class="anchor-link" href="#Is-this-process-any-good?">¶</a></h3><p>That is, how likely is it that the interval contains the parameter?</p>
<p>Explore this by repeating the entire process over and over again (from drawing and original sample to coming up with an interval), and see how often the interval contains the parameter (which luckily we happen to know is about 15.81).</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Repeat the entire process 100 times</span>

<span class="n">left_ends</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>
<span class="n">right_ends</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">first_sample</span> <span class="o">=</span> <span class="n">united</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">bootstrap_mean</span><span class="p">(</span><span class="n">first_sample</span><span class="p">,</span> <span class="s1">'Delay'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="n">left_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_ends</span><span class="p">,</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">means</span><span class="p">))</span>
    <span class="n">right_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_ends</span><span class="p">,</span> <span class="n">percentile</span><span class="p">(</span><span class="mf">97.5</span><span class="p">,</span> <span class="n">means</span><span class="p">))</span>

<span class="n">intervals</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
    <span class="s1">'Left'</span><span class="p">,</span> <span class="n">left_ends</span><span class="p">,</span>
    <span class="s1">'Right'</span><span class="p">,</span> <span class="n">right_ends</span>
<span class="p">)</span>    
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">intervals</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Left</th> <th>Right</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>10.225</td> <td>18.64 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>10.67 </td> <td>19.4  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>10.075</td> <td>18.245</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>10.305</td> <td>20.85 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>11.395</td> <td>23.83 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>12.085</td> <td>22.5  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>12.565</td> <td>24.325</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>15.03 </td> <td>31.135</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>9.08  </td> <td>16.32 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>10.015</td> <td>19.255</td>
        </tr>
    </tbody>
</table>
<p>... (90 rows omitted)</p></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">intervals</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">'Left'</span><span class="p">,</span> <span class="n">are</span><span class="o">.</span><span class="n">below</span><span class="p">(</span><span class="n">pop_mean</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">'Right'</span><span class="p">,</span> <span class="n">are</span><span class="o">.</span><span class="n">above</span><span class="p">(</span><span class="n">pop_mean</span><span class="p">))</span><span class="o">.</span><span class="n">num_rows</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>93</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>About 95% of the intervals contain the parameter. This has been proved in statistical theory, and you can observe it by re-running the code above.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Why does the bootstrap method work?</strong></p>
<ul>
<li>The original random sample is large. So with high probability, the original random sample resembles the population.</li>
<li>With high probability, random samples from the original sample resemble the original sample.</li>
<li>So with high probability, random samples from the original sample resemble the population too.</li>
</ul>
<p><strong>Caution: The bootstrap doesn't always work.</strong> More on that later.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-random-sample;-and-this-time-we-don't-have-the-population">A random sample; and this time we don't have the population<a class="anchor-link" href="#A-random-sample;-and-this-time-we-don't-have-the-population">¶</a></h3><p>Here is a typical problem of inference. The data below are from a random sample of mothers who delivered babies in a local hospital system. The goal is to estimate some unknown parameters in the population.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">baby</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">'baby.csv'</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">baby</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Birth Weight</th> <th>Gestational Days</th> <th>Maternal Age</th> <th>Maternal Height</th> <th>Maternal Pregnancy Weight</th> <th>Maternal Smoker</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>120         </td> <td>284             </td> <td>27          </td> <td>62             </td> <td>100                      </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>113         </td> <td>282             </td> <td>33          </td> <td>64             </td> <td>135                      </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>128         </td> <td>279             </td> <td>28          </td> <td>64             </td> <td>115                      </td> <td>True           </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>108         </td> <td>282             </td> <td>23          </td> <td>67             </td> <td>125                      </td> <td>True           </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>136         </td> <td>286             </td> <td>25          </td> <td>62             </td> <td>93                       </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>138         </td> <td>244             </td> <td>33          </td> <td>62             </td> <td>178                      </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>132         </td> <td>245             </td> <td>23          </td> <td>65             </td> <td>140                      </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>120         </td> <td>289             </td> <td>25          </td> <td>62             </td> <td>125                      </td> <td>False          </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>143         </td> <td>299             </td> <td>30          </td> <td>66             </td> <td>136                      </td> <td>True           </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>140         </td> <td>351             </td> <td>27          </td> <td>68             </td> <td>120                      </td> <td>False          </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Estimating-the-average-maternal-age-in-the-population">Estimating the average maternal age in the population<a class="anchor-link" href="#Estimating-the-average-maternal-age-in-the-population">¶</a></h3></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The distribution of maternal ages in the sample</span>

<span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'Maternal Age'</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">'year'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_30_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confidence_interval</span><span class="p">(</span><span class="n">baby</span><span class="p">,</span> <span class="s1">'Maternal Age'</span><span class="p">,</span> <span class="s1">'population mean'</span><span class="p">,</span> <span class="n">sample_mean</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Approx 95% bootstrap confidence interval for the population mean:
26.9 to 27.57
</pre></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_31_1.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This interval is the result of a process that gives a good answer about 95% of the time. We'll never know whether this interval is good (contains the parameter).Our confidence is in the procedure that generated the interval.</p>
<p>Notice that the empirical distribution of the sample <em>mean</em> ages is roughly bell shaped, even though the distribution of the ages in the sample is not.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-population-median">The population median<a class="anchor-link" href="#The-population-median">¶</a></h3><p>We can use the same bootstrap confidence interval function to estimate the population median.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># A new variable: birth weight relative to gestational days,</span>
<span class="c1"># ounces per day</span>

<span class="n">bw_gd</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">'Birth Weight'</span><span class="p">,</span> <span class="s1">'Gestational Days'</span><span class="p">])</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
<span class="s1">'BW/GD'</span><span class="p">,</span> <span class="n">baby</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">'Birth Weight'</span><span class="p">)</span><span class="o">/</span><span class="n">baby</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">'Gestational Days'</span><span class="p">))</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bw_gd</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Birth Weight</th> <th>Gestational Days</th> <th>BW/GD</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>120         </td> <td>284             </td> <td>0.422535</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>113         </td> <td>282             </td> <td>0.400709</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>128         </td> <td>279             </td> <td>0.458781</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>108         </td> <td>282             </td> <td>0.382979</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>136         </td> <td>286             </td> <td>0.475524</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>138         </td> <td>244             </td> <td>0.565574</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>132         </td> <td>245             </td> <td>0.538776</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>120         </td> <td>289             </td> <td>0.415225</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>143         </td> <td>299             </td> <td>0.478261</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>140         </td> <td>351             </td> <td>0.39886 </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The distribution of the ratio is almost bell shaped.</span>

<span class="n">bw_gd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'BW/GD'</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_36_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">sample_median</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">confidence_interval</span><span class="p">(</span><span class="n">bw_gd</span><span class="p">,</span> <span class="s1">'BW/GD'</span><span class="p">,</span> <span class="s1">'population median'</span><span class="p">,</span> <span class="n">sample_median</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Approx 95% bootstrap confidence interval for the population median:
0.43 to 0.43
</pre></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_38_1.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gd</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">percentile</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">gd</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>280</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_median</span><span class="p">(</span><span class="n">original_sample</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">):</span>
    <span class="sd">"""Empirical distribution of sample median:</span>
<span class="sd">    original_sample: table containing the original sample</span>
<span class="sd">    label: label of column containing the variable</span>
<span class="sd">    repetitions: number of repetitions of the bootstrap sampling process</span>
<span class="sd">    """</span>
    
    <span class="n">medians</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
        <span class="n">bootstrap_sample</span> <span class="o">=</span> <span class="n">original_sample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="n">new_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="n">medians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">medians</span><span class="p">,</span> <span class="n">new_median</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">medians</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bstrap_medians</span> <span class="o">=</span> <span class="n">bootstrap_median</span><span class="p">(</span><span class="n">sample1</span><span class="p">,</span> <span class="s1">'Delay'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'Bootstrap Sample Median'</span><span class="p">,</span> <span class="n">bstrap_medians</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="/notebooks-images/Draft_Bootstrap_42_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">percentile</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">united</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">'Delay'</span><span class="p">))</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>2</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div></div></div></div>